# Vault Values File
# This file contains configuration for HashiCorp Vault
# Used by: All platform components for secrets management

# Server Configuration
server:
  # High Availability Mode
  ha:
    enabled: true
    replicas: 3
  
  # Data Storage (disabled - using PostgreSQL backend instead)
  dataStorage:
    enabled: false
  
  # Audit Storage
  auditStorage:
    enabled: true
    size: 10Gi
    storageClass: fast-ssd
  
  # PostgreSQL storage backend configuration
  # Connection URL from External Secret (vault-postgres-connection)
  extraEnvironmentVars:
    VAULT_PG_CONNECTION_URL:
      valueFrom:
        secretKeyRef:
          name: vault-postgres-connection
          key: connection_url
  # Mount ConfigMap with PostgreSQL storage configuration
  extraVolumes:
    - type: configMap
      name: vault-postgres-config
  extraVolumeMounts:
    - mountPath: /vault/config/postgres
      name: vault-postgres-config
      readOnly: true
  # Configure Vault to use the PostgreSQL config file
  extraArgs: -config=/vault/config/postgres/vault-postgres.hcl
  
  # Resources
  resources:
    requests:
      cpu: 500m
      memory: 512Mi
    limits:
      cpu: 2000m
      memory: 2Gi

# UI Configuration
ui:
  enabled: true

# Ingress Configuration
ingress:
  enabled: true
  ingressClassName: traefik
  hosts:
    - host: ${VAULT_HOST}
      paths:
        - /
  tls:
    - secretName: vault-tls
      hosts:
        - ${VAULT_HOST}
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"

# Service Account
serviceAccount:
  create: true
  name: vault

# Security Context
securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

# Note: PostgreSQL connection URL is configured in server.extraEnvironmentVars above

# Affinity (for HA)
affinity: {}

# Tolerations
tolerations: []

# Node Selectors
nodeSelector: {}

